<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CommonJS 规范</title>

    <link rel="stylesheet" href="../../platform/javascript/syntaxhighlighter/styles/shCoreDefault.css" type="text/css" />

    <link rel="stylesheet" href="../../platform/css/base.css" type="text/css"/>
    <link rel="stylesheet" href="../../platform/css/platform.css" type="text/css"/>
    <link rel="stylesheet" href="../../platform/css/theme/skyblue.css" type="text/css"/>
    <link rel="stylesheet" href="../../platform/css/web.css" type="text/css"/>

    <style>
      body{
        padding:10px;
      }
    </style>

    <script type="text/javascript" src="../../platform/javascript/jquery/jquery.js"></script>

    <script type="text/javascript" src="../../platform/javascript/syntaxhighlighter/scripts/shCore.js"></script>
    <script type="text/javascript" src="../../platform/javascript/syntaxhighlighter/scripts/shBrushXml.js"></script>
    <script type="text/javascript" src="../../platform/javascript/syntaxhighlighter/scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="../../platform/javascript/view/init.js"></script>
  </head>
  <body>
    <h3 class="h-web-paragraph-title">目录</h3>
    <ol class="h-web-catalogue">
      <li>
        <a paragraph href="#">CommonJS 介绍</a>
      </li>
      <li>
        <a paragraph href="#">Module 机制和依赖管理</a>
      </li>
      <li>
        <a paragraph href="#"> AMD 模块规范和 CMD 模块规范</a>
        <ol class="h-web-catalogue2">
          <li>
            <a href="#">AMD模块规范</a>
          </li>
          <li>
            <a href="#">CMD模块规范</a>
          </li>
        </ol>
      </li>
      <li>
        <a paragraph href="#">参考资料</a>
      </li>
    </ol>

    <div class="h-web-paragraph">
      <h3 paragraph>CommonJS 介绍</h3>
      <div>
        <p><a href="http://www.commonjs.org/">官网</a></p>
        <p>CommonJs  是什么东东，我们借用官网的说明</p>
        <p>
          JavaScript is a powerful object oriented language with some of the fastest dynamic language interpreters around. The official JavaScript specification defines APIs for some objects that are useful for building browser-based applications. However, the spec does not define a standard library that is useful for building a broader range of applications.
        </p>
        <p>The CommonJS API will fill that gap by defining APIs that handle many common application needs, ultimately providing a standard library as rich as those of Python, Ruby and Java. The intention is that an application developer will be able to write an application using the CommonJS APIs and then run that application across different JavaScript interpreters and host environments. With CommonJS-compliant systems, you can use JavaScript to write:
        </p>
        <ul>
          <li>Server-side JavaScript applications</li>
          <li>Command line tools</li>
          <li>Desktop GUI-based applications</li>
          <li>Hybrid applications (Titanium, Adobe AIR)</li>
        </ul>
        <p>翻译成中文如下</p>
        <p>
          Javascript是一款非常强大的面向对象编程语言，他拥有快速高效的解释器。Javascript提供定义了一些对象的APIs用来构建基于浏览器的应用。然而，他没有定义一个标准库用来构建更广泛的应用。
        </p>
        <p>
          CommonJS 将会定义更通用的应用API，提供一个标准库。它的终极目标是提供一个类似Python，Ruby和Java的标准库。这样开发者就可以使用CommonJS API编写通用的应用程序，
          这些应用可以运行在不同的JavaScript解释器和不同的环境中。遵循CommonJS 规范，你可以使用 JavaScript开发：
        </p>
        <ul>
          <li>服务器端JavaScript应用程序</li>
          <li>命令行工具</li>
          <li>图形界面应用程序</li>
          <li>混合应用程序（如：Titanium或Adobe AIR）</li>
        </ul>
        <p>CommonJS是在2009年8月诞生的，他的遵旨是制定一些规范，并不提供默认实现，而是要求一些JavaScript库、框架、环境……去实现它的这些API定义。CommonJS 规范包括了
          二进制（Binary）、控制台（Console）、编码（Encodings）、文件系统（Filesystems）、HTTP Client、IO、模块（Modules）、包（Packages）、权限（Promises）、单元测试（Unit Testing ）等。
          引用官方的说明，CommnJS 当前的标准化</p>
        <p>This is a list of issues currently being discussed / standardized. They come from the "Low level" department, as we need to have solid basics prior to building a tower.</p>
        <p><a href="http://wiki.commonjs.org/wiki/Modules" title="Modules">Modules</a> (<a href="http://wiki.commonjs.org/wiki/Modules/1.1.1" title="Modules/1.1.1">1.1.1</a>)</p>
        <ol>
          <li>binary: <a href="http://wiki.commonjs.org/wiki/Binary" title="Binary">Binary</a> Data Objects (byte arrays and/or strings) (proposals, discussion, early implementations)</li>
          <li>encodings: <a href="http://wiki.commonjs.org/wiki/Encodings" title="Encodings">Encodings</a> and character sets (proposals, discussion, early implementations)</li>
          <li>io: <a href="http://wiki.commonjs.org/wiki/IO" title="IO">I/O Streams</a> (proposals, discussion)</li>
          <li>fs, fs-base: <a href="http://wiki.commonjs.org/wiki/Filesystem" title="Filesystem">Filesystem</a> (proposals, discussion, early implementations)</li>
          <li>system: <a href="http://wiki.commonjs.org/wiki/System" title="System">System</a> Interface (stdin, stdout, stderr, &amp;c) (<a href="http://wiki.commonjs.org/wiki/System/1.0" title="System/1.0">1.0</a>, amendments proposed)</li>
          <li>assert, test: <a href="http://wiki.commonjs.org/wiki/Unit_Testing" title="Unit Testing">Unit Testing</a> (<a href="http://wiki.commonjs.org/wiki/Unit_Testing/1.0" title="Unit Testing/1.0">1.0</a>, amendment proposals pending)</li>
          <li>sockets: <a href="http://wiki.commonjs.org/wiki/Sockets" title="Sockets">Socket I/O</a> TCP/IP sockets (early proposals)</li>
          <li>event-queue: <a href="http://wiki.commonjs.org/wiki/Reactor" title="Reactor">Reactor</a> Reactor/Event Queue (early proposals)</li>
          <li>worker: <a href="http://wiki.commonjs.org/wiki/Worker" title="Worker">Worker</a> Worker (concurrent shared nothing process/thread) (proposal)</li>
          <li>console: <a href="http://wiki.commonjs.org/wiki/Console" title="Console">console</a> (proposal)</li>
        </ol>
        <p>基于CommonJs 规范实现的有 RequireJS 、Sea.js、Node.js等。</p>
      </div>
      <h3 paragraph>Module 机制和依赖管理</h3>
      <div>
        <p>CommonJs 提供了一个很重要的约定，Module 机制，我们看一下模块机制主要有哪些内容</p>
        <ul>
          <li>一个文件就是一个module</li>
          <li>用声明语句导入想要的东西</li>
          <li>不会意外获得不想要的东西</li>
          <li>导入前模块不会解析执行</li>
          <li>不同的文件有各自独立的命名空间</li>
          <li>模块文件内顶层的命名空间转变成模块对象</li>
          <li>模块文件自带依赖信息</li>
        </ul>
        <p>浏览器中js现状</p>
        <ul>
          <li>很难把JS的文件当作Module单元来使用</li>
          <li>没有相关的声明语句，只能用异步加载文件的方式模拟导入的效果</li>
          <li>可能隐式的导入很多全局变量，覆盖或修改当前的内容</li>
          <li>所有文件一开始都会解析执行</li>
          <li>JS存在全局作用域，不同文件会共享同一个全局命名空间</li>
          <li>导入之后不管你想不想要，那个文件里的东西全部注入到当前的命名空间里</li>
          <li>JS文件自身也不包含依赖信息，如果有打包合并之类的操作，我们可能会把依赖信息写在另外的配置文件里</li>
        </ul>

        <p>我们看一下Node.js。他采用了CommonJS规范，一个单独的文件就是一个模块。加载模块使用require方法，该方法读取一个文件并执行，最后返回文件内部的exports对象。看下面例子</p>
        <pre>
//example.js
console.log("evaluating example.js");
var invisible = function () {
  console.log("invisible");
}
exports.message = "hi";
exports.say = function () {
  console.log(message);
}
        </pre>
        <p>使用require方法，加载example.js。</p>
        <pre>var example = require('./example.js');</pre>
        <p>这时，变量example就对应模块中的exports对象</p>


      </div>
      <h3 paragraph> AMD 模块规范和 CMD 模块规范</h3>
      <div>
        <h4>AMD模块规范</h4>
        <p>CommonJS 提出了一种用于同步或异步动态加载JavaScript代码的API规范，非常简单却很优雅，称之为 <a href="https://github.com/amdjs/amdjs-api/wiki/AMD">AMD（Modules/AsynchronousDefinition）</a>。
          规范本身非常简单，只包含了一个API：</p>
        <pre>define([module-name?], [array-of-dependencies?], [module-factory-or-object]);</pre>
        <p>RequireJs是基于AMD模块规范的。</p>
        <p>匿名模块，即省略了模块名</p>
        <pre>
define(['package/lib'], function(lib){
    function foo(){
        lib.log('hello world!');
    } 
    return {
        foo: foo
    };
});
        </pre>
        <p>一个完整的例子</p>
        <pre>
 define("alpha", ["require", "exports", "beta"], function (require, exports, beta) {
     exports.verb = function() {
         return beta.verb();
         //Or:
         return require("beta").verb();
     }
 });          
        </pre>

        <p>AMD规范允许输出的模块兼容CommonJS规范（用一个简单的CommonJS来包裹），这时define方法需要写成下面这样：</p>
        <pre>
define(function( require, exports, module )
    var someModule = require( "someModule" );
    var anotherModule = require( "anotherModule" );    
    someModule.doTehAwesome();
    anotherModule.doMoarAwesome();
    exports.asplode = function() {
        someModule.doTehAwesome();
        anotherModule.doMoarAwesome();
    };
});
        </pre>

        <h4>CMD模块规范</h4>
        <p>CMD（<a href="https://github.com/cmdjs/specification/blob/master/draft/module.md">Common Module Definition</a>）即通用模块定义规范</p>
        <p>在 CMD 规范中，一个模块就是一个文件。代码的书写格式如下：</p>
        <pre>define(factory);</pre>
        <p>define接受的参数 factory 可以是一个函数，也可以是一个对象或字符串，甚至other valid values。
          factory 为对象、字符串时，表示模块的接口就是该对象、字符串。比如可以如下定义一个 JSON 数据模块：</p>
        <pre>define({ "foo": "bar" });</pre>
        <p>也可以通过字符串定义模板模块：</p>

        <pre>define('I am a template. My name is {{name}}.');</pre>
        <p>factory 为函数时，表示是模块的构造方法。执行该构造方法，可以得到模块向外提供的接口。factory 方法在执行时，默认会传入三个参数：require、exports 和 module：</p>
        <pre>
define(function(require, exports, module) {
   // 模块代码
});         
        </pre>
        <p>require 是一个 function，加载依赖的模块，exports 和 module都是一个对象</p>
        <p>下面是一个简单的例子</p>
        <pre>
//math.js
define(function(require, exports, module) {
  exports.add = function() {
    var sum = 0, i = 0, args = arguments, l = args.length;
    while (i < l) {
      sum += args[i++];
    }
    return sum;
  };
});   

//increment.js
define(function(require, exports, module) {
  var add = require('math').add;
  exports.increment = function(val) {
    return add(val, 1);
  };
});


//program.js
define(function(require, exports, module) {
  var inc = require('increment').increment;
  var a = 1;
  inc(a); // 2
  module.id == "program";
});       
        </pre>
        <p><a href="">Sea.js模块化</a>是遵循 CMD的</p>
        <p>关于AMD和CMD的区别，可以参考 <a href="http://www.zhihu.com/question/20351507/answer/14859415">玉伯的解答</a>。</p>
        <p>关于 RequireJs 和 SeaJs 的不同，可以参考 <a href="https://github.com/seajs/seajs/issues/277">这里</a></p>
      </div>
      <h3 paragraph>参考资料</h3>
      <div>
        <p><a href="http://raychase.iteye.com/blog/1463617">关于CommonJS</a></p>
        <p><a href="http://wenku.baidu.com/link?url=wJZlgce_QHeLF4mxEBSJ9a7zm6XK95OXxqkW3tfmSLq9CnRAQkGo4aFelAVxxbagGIzYTJeZWahkubyl9oP4WMIilpmOjszzOY8pCt49NWu">CommonJS时代的JS模块和编译工具</a></p>
        <p><a href="http://javascript.ruanyifeng.com/nodejs/commonjs.html">CommonJS规范</a>，该文档（作者是阮一峰）中也介绍了javascript基础，值的一读。</p>
        <p><a href="http://www.cnblogs.com/litao229/archive/2012/04/10/2440274.html">js模块化开发---js大项目代码组织和多人协作的解决之道</a></p>
      </div>

    </div>
  </body>
</html>